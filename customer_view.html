<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>B2B CRM 고객조회</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-blue-50 h-screen flex overflow-hidden">
  <!-- ✅ 좌측 사이드 메뉴 -->
  <aside class="w-[230px] bg-blue-800 text-white flex-shrink-0">
    <a href="b2b_dashboard_tailwind.html" class="block p-5 text-lg font-semibold border-b border-blue-700 hover:bg-blue-700 transition">
      B2B CRM 메뉴
    </a>

    <nav class="p-3 space-y-2">
      <!-- 통합메뉴 -->
      <div>
        <button id="menuToggle1" class="w-full flex justify-between items-center px-4 py-2 rounded-lg hover:bg-blue-700 transition">
          <span>발송관리</span>
          <span>▼</span>
        </button>
        <div id="menu1" class="hidden ml-4 mt-2 space-y-1 text-sm">
          <a href="#" class="block px-3 py-1 hover:bg-blue-700 rounded">SMS 발송</a>
          <a href="#" class="block px-3 py-1 hover:bg-blue-700 rounded">E-Mail 발송</a>
          <a href="#" class="block px-3 py-1 hover:bg-blue-700 rounded">알림톡 발송</a>
        </div>
      </div>

      <!-- 관리메뉴 -->
      <div>
        <button id="menuToggle2" class="w-full flex justify-between items-center px-4 py-2 rounded-lg hover:bg-blue-700 transition">
          <span>관리메뉴</span>
          <span>▼</span>
        </button>
        <div id="menu2" class="ml-4 mt-2 space-y-1 text-sm">
          <a href="b2b_dashboard_tailwind.html" class="block px-3 py-1 hover:bg-blue-700 rounded">상담 현황</a>
          <a href="company_list.html" class="block px-3 py-1 hover:bg-blue-700 rounded">기업 목록</a>
          <a href="customer_list.html" class="block px-3 py-1 hover:bg-blue-700 rounded">고객 목록</a>
          <a href="#" class="block px-3 py-1 hover:bg-blue-700 rounded">수강시간 조회</a>
          <a href="#" class="block px-3 py-1 hover:bg-blue-700 rounded">학습상담·CS 관리</a>
          <a href="customer_registration.html" class="block px-3 py-1 hover:bg-blue-700 rounded">신규 고객 등록</a>
        </div>
      </div>
    </nav>
  </aside>

  <!-- ✅ 본문 전체 -->
  <div class="flex-1 flex flex-col">
    <!-- ✅ 상단 고정: 응대입력 -->
    <header class="sticky top-0 bg-white shadow p-5 z-10">
      <div class="w-full">
        <h2 class="text-xl font-semibold text-gray-800 border-b pb-4 mb-6">응대 내용 입력</h2>
        <div class="grid grid-cols-4 gap-4 mb-4">
          <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-blue-400">
            <option>담당자 선택</option>
            <option>홍길동</option>
            <option>이현우</option>
            <option>박지현</option>
          </select>
          <select id="statusSelect" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-blue-400">
            <option>처리상태 선택</option>
            <option value="처리대기" class="text-red-600 font-semibold">처리대기</option>
            <option value="처리완료" class="text-green-600 font-semibold">처리완료</option>
          </select>
          <select id="categoryMain" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-blue-400">
            <option value="">대분류 선택</option>
            <option value="수강·결제">수강·결제</option>
            <option value="수강환경·접속">수강환경·접속</option>
            <option value="학습진행·평가">학습진행·평가</option>
            <option value="강의·강사">강의·강사</option>
            <option value="기타·제휴">기타·제휴</option>
          </select>
          <select id="categorySub" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-blue-400 disabled:bg-gray-100 disabled:cursor-not-allowed" disabled>
            <option value="">중분류 선택</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <textarea placeholder="문의 내용을 입력하세요..." class="border border-gray-300 rounded-lg px-3 py-2 w-full h-24 focus:ring-blue-400 focus:outline-none"></textarea>
          <div class="flex flex-col space-y-2">
            <input type="text" placeholder="제목을 입력하세요" class="w-full border border-blue-300 bg-blue-50 rounded-lg px-3 py-2 text-sm focus:ring-blue-400 placeholder:font-medium" />
            <textarea placeholder="응대 내용을 입력하세요..." class="border border-gray-300 rounded-lg px-3 py-2 w-full flex-1 focus:ring-blue-400 focus:outline-none"></textarea>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-1 overflow-y-auto p-6 space-y-8">
      <!-- ✅ 고객 정보 & 기능 메뉴 -->
      <section class="bg-white rounded-xl shadow p-5">
        <div class="flex justify-between items-start">
          <!-- 고객 정보 -->
          <div class="w-2/3 pr-4">
            <h2 class="text-lg font-semibold">
              LG화학 / 김해커 (2025-09-25 17:30:56)
            </h2>
            <p class="text-sm text-gray-500 mb-2">상담자: 홍길동 (영업팀)</p>
            <div class="mt-4 text-sm text-gray-800 space-y-4">
              <!-- 3열 그리드 -->
              <div class="grid grid-cols-3">
                <!-- 1열: 기업정보 -->
                <div>
                  <h4 class="font-bold text-blue-600">[기업정보]</h4>
                  <div class="mt-2 border-t border-l border-gray-200">
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">회원구분</span><span class="p-2 border-b border-gray-200">기업관리자</span></div>
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">기업코드</span><span class="p-2 border-b border-gray-200">lgchem</span></div>
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">기업명</span><span class="p-2 border-b border-gray-200">LG화학</span></div>
                  </div>
                </div>
                <!-- 2열: 고객정보 -->
                <div>
                  <h4 class="font-bold text-blue-600">[고객정보]</h4>
                  <div class="mt-2 border-t border-l border-gray-200">
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">이름</span><span class="p-2 border-b border-gray-200">김해커</span></div>
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">아이디</span><span class="p-2 border-b border-gray-200">lgchem01</span></div>
                    <div class="grid grid-cols-[80px_1fr]"><span id="customer-phone" class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">전화번호</span><span class="p-2 border-b border-gray-200">010-1234-5678</span></div>
                  </div>
                </div>
                <!-- 3열: 구분 -->
                <div>
                  <h4 class="font-bold text-blue-600">[구분]</h4>
                  <div class="mt-2 border-t border-l border-r border-gray-200">
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">대분류</span><span class="p-2 border-b border-gray-200">수강·결제</span></div>
                    <div class="grid grid-cols-[80px_1fr]"><span class="p-2 font-semibold bg-gray-50 border-r border-b border-gray-200">중분류</span><span class="p-2 border-b border-gray-200">결제오류</span></div>
                  </div>
                </div>
              </div>

              <!-- 내부정보 -->
              <div class="pt-4">
                <h4 class="font-bold text-blue-600">[내부정보]</h4>
                <div class="grid grid-cols-3 mt-2">
                  <div class="grid grid-cols-[96px_1fr] border-t border-l border-b border-gray-200"><span class="p-2 font-semibold bg-gray-50 border-r border-gray-200">영업 담당자</span><span class="p-2">박지현</span></div>
                  <div class="grid grid-cols-[96px_1fr] border-t border-l border-b border-gray-200"><span class="p-2 font-semibold bg-gray-50 border-r border-gray-200">운영 담당자</span><span class="p-2">김민준</span></div>
                  <div class="border-t border-b border-r border-gray-200"></div>
                </div>
              </div>

            </div>
          </div>
          <!-- 기능 메뉴 -->
          <div class="w-1/3 pl-4 border-l">
            <h3 class="font-semibold text-lg mb-3 text-blue-700">기능 메뉴</h3>
            <div class="space-y-2 text-sm">
              <div class="grid grid-cols-2 gap-2">
              <button id="menuUserInfo" class="w-full text-center px-4 py-2 rounded-lg bg-blue-50 hover:bg-blue-100 transition">
                회원 정보
              </button>
              <button id="menuDeliveryInfo" class="w-full text-center px-4 py-2 rounded-lg bg-blue-50 hover:bg-blue-100 transition">
                배송지 정보
              </button>
              </div>
              <div class="grid grid-cols-2 gap-2">
              <button id="menuAdminSite" class="w-full text-center px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition">
                관리자 로그인
              </button>
              <button id="menuUserSite" class="w-full text-center px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition">
                학습자ID 로그인
              </button>
              <button id="menuSendSms" class="w-full text-center px-4 py-2 rounded-lg bg-blue-50 hover:bg-blue-100 transition">문자 전송</button>
              <button id="menuSendEmail" class="w-full text-center px-4 py-2 rounded-lg bg-blue-50 hover:bg-blue-100 transition">이메일 전송</button>
            </div>
          </div>
        </div>

      </section>

      <!-- ✅ 상담이력 -->
      <section class="bg-white rounded-xl shadow p-5 flex space-x-6 h-[500px]">
        <!-- ✅ 좌측: 상담 목록 -->
        <div class="w-1/2 flex flex-col">
          <h3 class="font-semibold text-lg mb-3 text-blue-700">상담이력</h3>
          <div class="overflow-x-auto overflow-y-auto flex-1">
            <table class="w-full text-sm border-collapse table-auto">
              <thead class="bg-blue-100 text-gray-700">
                <tr>
                  <th class="p-3">상담일시</th>
                  <th class="p-3">상담채널</th>
                  <th class="p-3">제목</th>
                  <th class="p-3">진행상태</th>
                  <th class="p-3">담당자</th>
                </tr>
              </thead>
              <tbody id="history-body"></tbody>
            </table>
          </div>
          <button id="history-more"
            class="hidden mt-3 bg-blue-100 text-blue-600 px-3 py-1 rounded hover:bg-blue-200 text-sm">
            더보기
          </button>
        </div>

        <!-- ✅ 우측: 상담 상세보기 -->
        <div id="history-detail"
          class="w-1/2 hidden bg-blue-50 rounded-lg p-4 border border-blue-200 overflow-y-auto">
          <p class="text-gray-500 text-sm text-center">상담 내역을 선택하세요.</p>
        </div>
      </section>



      <!-- ✅ 학습관리 -->
      <section class="bg-white rounded-xl shadow p-5 flex flex-col max-h-[500px]">
        <h3 class="font-semibold text-lg mb-3 text-blue-700">학습관리</h3>

        <div class="overflow-x-auto overflow-y-auto flex-1">
          <table class="w-full text-sm border-collapse table-auto">
            <thead class="bg-blue-100 text-gray-700">
              <tr>
                <th class="p-3">학습차수</th>
                <th class="p-3">강의코드</th>
                <th class="p-3">강의명</th>
                <th class="p-3">교육기간</th>
                <th class="p-3">복습기간</th>
                <th class="p-3">출석률</th>
                <th class="p-3">출석점수</th>
                <th class="p-3">시험점수</th>
                <th class="p-3">모의고사 점수</th>
                <th class="p-3">레벨점수</th>
                <th class="p-3">등급</th>
                <th class="p-3">수료여부</th>
                <th class="p-3">기준수료점수</th>
                <th class="p-3">강의제공업체</th>
                <th class="p-3">등록일</th>
              </tr>
            </thead>
            <tbody id="study-body"></tbody>
          </table>
        </div>

        <p id="study-empty" class="hidden text-gray-500 text-sm mt-4 text-center">
          데이터가 없습니다.
        </p>

        <button id="study-more"
          class="hidden mt-3 bg-blue-100 text-blue-600 px-3 py-1 rounded hover:bg-blue-200 text-sm">
          더보기
        </button>
      </section>




      <!-- ✅ 배송관리 -->
      <section class="bg-white rounded-xl shadow p-5 flex flex-col max-h-[500px]">
        <h3 class="font-semibold text-lg mb-3 text-blue-700">배송관리</h3>

        <!-- ✅ 가로 스크롤 감싸기 -->
        <div class="overflow-x-auto overflow-y-auto flex-1">
          <table class="w-full text-sm border-collapse table-auto">
            <thead class="bg-blue-100 text-gray-700">
              <tr>
                <th class="p-3">주문일</th>
                <th class="p-3">주문번호</th>
                <th class="p-3">교재명</th>
                <th class="p-3">주문액</th>
                <th class="p-3">서점 주문번호</th>
                <th class="p-3">택배사</th>
                <th class="p-3">송장번호</th>
                <th class="p-3">주문상태</th>
                <th class="p-3">결제일</th>
                <th class="p-3">배송방법</th>
              </tr>
            </thead>
            <tbody id="delivery-body"></tbody>
          </table>
        </div>

        <!-- ✅ 데이터 없을 때 표시 -->
        <p id="delivery-empty" class="hidden text-gray-500 text-sm mt-4 text-center">
          데이터가 없습니다.
        </p>

        <button id="delivery-more"
          class="hidden mt-3 bg-blue-100 text-blue-600 px-3 py-1 rounded hover:bg-blue-200 text-sm">
          더보기
        </button>
      </section>


      <!-- ✅ 모달 구조 -->
      <div id="modalOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-[750px] max-h-[80vh] overflow-y-auto p-6 relative border-4 border-blue-300">
          <h3 id="modalTitle" class="text-2xl font-bold text-blue-700 mb-4 pb-2 border-b-2 border-blue-200">
            정보 보기
          </h3>
          <div id="modalContent" class="text-sm text-gray-700"></div>
          <div class="flex justify-end mt-6 space-x-3">
            <button id="saveBtn" class="hidden bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition font-semibold shadow-md">
              저장하기
            </button>
            <button id="closeBtn" class="bg-gray-400 text-white px-5 py-2 rounded-lg hover:bg-gray-500 transition font-semibold shadow-md">
              닫기
            </button>
          </div>
        </div>
      </div>

      <!-- ✅ 학습관리 전용 모달 -->
      <div id="studyActionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-96 p-6 relative border-4 border-blue-300">
          <h3 class="text-xl font-bold text-blue-700 mb-6 text-center">학습 관리</h3>
          <div class="space-y-3">
            <button onclick="alert('시험 재응시 기능이 실행됩니다.')" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-gray-100 transition font-semibold shadow-sm text-lg">
              시험 재응시
            </button>
            <button onclick="alert('수강기간 연장 기능이 실행됩니다.')" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-gray-100 transition font-semibold shadow-sm text-lg">
              수강기간 연장
            </button>
            <button onclick="alert('연장 초기화 기능이 실행됩니다.')" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-gray-100 transition font-semibold shadow-sm text-lg">
              연장 초기화
            </button>
            <button onclick="alert('평가시험창 재진입 기능이 실행됩니다.')" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-gray-100 transition font-semibold shadow-sm text-lg">
              평가시험창 재진입
            </button>
            <button onclick="alert('삭제 기능이 실행됩니다.')" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-red-500 hover:text-white transition font-semibold shadow-sm text-lg">
              삭제
            </button>
          </div>
          <button id="closeStudyModalBtn" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
        </div>
      </div>

      <!-- ✅ 문자 발송 모달 -->
      <div id="smsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[80vh] overflow-y-auto p-6 relative border-4 border-blue-300 flex space-x-6">
          <!-- 좌측: 템플릿 목록 -->
          <div class="w-1/2 flex flex-col">
            <h3 class="text-xl font-bold text-blue-700 mb-4">문자 템플릿</h3>
            <input type="text" id="templateSearch" placeholder="템플릿 제목 검색..." class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-3 text-sm focus:ring-blue-400 focus:outline-none">
            <div class="flex-1 overflow-y-auto border rounded-lg">
              <table class="w-full text-sm">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="p-2 w-16">연번</th>
                    <th class="p-2 text-left">템플릿 제목</th>
                  </tr>
                </thead>
                <tbody id="smsTemplateBody"></tbody>
              </table>
            </div>
            <div id="templatePagination" class="flex justify-center items-center mt-3 space-x-2 text-sm"></div>
          </div>
          <!-- 우측: 발송 정보 -->
          <div class="w-1/2">
            <h3 class="text-xl font-bold text-blue-700 mb-4">발송 내용</h3>
            <div class="space-y-4 text-sm">
              <div><label class="font-semibold">발신번호</label><input type="text" id="smsSender" value="02-000-0000" class="w-full mt-1 bg-gray-100 border border-gray-300 rounded-lg px-3 py-2" readonly></div>
              <div><label class="font-semibold">수신번호</label><input type="text" id="smsReceiver" class="w-full mt-1 bg-gray-100 border border-gray-300 rounded-lg px-3 py-2" readonly></div>
              <div><label class="font-semibold">내용</label><textarea id="smsContent" rows="10" class="w-full mt-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-400 focus:outline-none" placeholder="문자 내용을 입력하거나 템플릿을 선택하세요."></textarea></div>
            </div>
            <div class="flex justify-end mt-6 space-x-3"><button id="sendSmsBtn" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition font-semibold">발송하기</button><button id="closeSmsModalBtn" class="bg-gray-400 text-white px-5 py-2 rounded-lg hover:bg-gray-500 transition font-semibold">닫기</button></div>
          </div>
        </div>
      </div>

      <!-- ✅ 이메일 전송 모달 -->
      <div id="emailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-96 p-6 relative border-4 border-blue-300">
          <h3 class="text-xl font-bold text-blue-700 mb-6 text-center">이메일 전송</h3>
          <div class="space-y-3">
            <button id="sendWebmail" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-gray-100 transition font-semibold shadow-sm text-lg">
              웹메일 (Biz)
            </button>
            <button id="sendPassmail" class="w-full bg-white border border-gray-300 text-gray-800 px-5 py-3 rounded-lg hover:bg-gray-100 transition font-semibold shadow-sm text-lg">
              패스메일 (fnBiz)
            </button>
          </div>
          <button id="closeEmailModalBtn" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
        </div>
      </div>

      <script>
        // ✅ 사이드메뉴 토글 (다른 페이지와 동일)
        const menuToggle1 = document.getElementById("menuToggle1");
        const menu1 = document.getElementById("menu1");
        const menuToggle2 = document.getElementById("menuToggle2");
        const menu2 = document.getElementById("menu2");

        menuToggle1.addEventListener("click", () => menu1.classList.toggle("hidden"));
        menuToggle2.addEventListener("click", () => menu2.classList.toggle("hidden"));
        menu2.classList.remove("hidden"); // 관리메뉴는 기본으로 열어둠

        // 🔹 대분류-중분류 연동 기능
        const categoryMap = {
          "수강·결제": ["결제오류", "환불문의", "영수증발급", "할인문의", "결제방법"],
          "수강환경·접속": ["로그인문제", "비밀번호찾기", "계정오류", "접속불가", "브라우저문제"],
          "학습진행·평가": ["진도율문의", "시험응시", "과제제출", "수료증발급", "성적문의"],
          "강의·강사": ["강사평가", "강의내용", "강의자료", "강의오류", "강의요청"],
          "기타·제휴": ["제휴문의", "견적문의", "단체문의", "기타", "건의사항"]
        };

        const categoryMainSelect = document.getElementById("categoryMain");
        const categorySubSelect = document.getElementById("categorySub");

        // 대분류 선택 시 중분류 업데이트
        categoryMainSelect.addEventListener("change", function() {
          const selectedMain = this.value;
          categorySubSelect.innerHTML = '<option value="">중분류 선택</option>';
          
          if (selectedMain && categoryMap[selectedMain]) {
            categoryMap[selectedMain].forEach(sub => {
              const option = document.createElement("option");
              option.value = sub;
              option.textContent = sub;
              categorySubSelect.appendChild(option);
            });
            categorySubSelect.disabled = false;
          } else {
            categorySubSelect.disabled = true;
          }
        });

        // ✅ 처리상태 드롭다운 색상 변경
        const statusSelect = document.getElementById("statusSelect");
        statusSelect.addEventListener("change", function() {
          // 먼저 모든 색상 및 굵기 클래스를 제거합니다.
          this.classList.remove("text-red-600", "text-green-600", "font-semibold");

          const selectedValue = this.value;

          if (selectedValue === "처리대기") {
            this.classList.add("text-red-600", "font-semibold");
          } else if (selectedValue === "처리완료") {
            this.classList.add("text-green-600", "font-semibold");
          }
        });


        // 1️⃣ --- 더미데이터 (맨 위로 이동해야 함) ---
        
        // ✅ 회원 정보 더미 데이터
        const memberData = {
          "기업": "LG화학",
          "이름": "김해커",
          "아이디": "lgchem01",
          "Password": "초기화", // 실제 값 대신 UI 처리를 위한 값
          "기업코드": "lgchem",
          "이메일": "kim.hacker@lgchem.com",
          "연락처(hp)": "010-1234-5678",
          "연락처(home)": "02-3773-1234",
          "주소": "서울특별시 강남구 테헤란로 231",
          "상세주소": "LG화학 본사 빌딩 5층",
          "회원가입일": "2023-01-10"
        };

        // ✅ 배송지 정보 더미 데이터
        const deliveryData = {
          "받는사람": "김해커",
          "연락처": "02-3773-1234",
          "핸드폰번호": "010-1234-5678",
          "우편번호": "06142",
          "주소": "서울특별시 강남구 테헤란로 231",
          "상세주소": "LG화학 본사 빌딩 5층",
          "배송비고": "부재 시 경비실에 맡겨주세요",
          "배송지 입력일자": "2023-01-15"
        };

        // ✅ 문자 템플릿 더미 데이터 (20개)
        const smsTemplates = Array.from({ length: 20 }, (_, i) => {
            const type = ["안내", "독려", "이벤트", "공지"][i % 4];
            let content = "";
            if (type === "안내") content = `[해커스] 안녕하세요, {고객명}님. 요청하신 학습 상담 관련 안내 드립니다.`;
            else if (type === "독려") content = `[해커스] {고객명}님, 학습 진도율이 목표에 미치지 못하고 있습니다. 조금만 더 힘내주세요!`;
            else if (type === "이벤트") content = `[해커스] {고객명}님을 위한 특별 이벤트! 지금 바로 확인해보세요. (링크)`;
            else content = `[해커스] 시스템 점검이 예정되어 있습니다. ({날짜}) 불편을 드려 죄송합니다.`;
            
            return {
                id: i + 1,
                title: `[${type}] 템플릿 ${i + 1}`,
                content: content,
            };
        });
        
        const historyData = Array.from({ length: 10 }, (_, i) => ({
          channel: i % 2 === 0 ? "1:1 문의게시판" : "전화상담",
          categoryMain: ["수강·결제", "수강환경·접속", "학습진행·평가", "강의·강사", "기타·제휴"][i % 5],
          categorySub: ["결제오류", "로그인문제", "진도율문의", "강사평가", "제휴문의"][i % 5],
          date: `2025-09-${String(10 + i).padStart(2, '0')}`,
          datetime: `2025-09-${String(10 + i).padStart(2, '0')} ${String(14 + i).padStart(2, '0')}:${String(20 + (i * 3) % 60).padStart(2, '0')}`,
          title: `상담 테스트 ${i + 1}`,
          status: i % 2 === 0 ? "처리완료" : "처리대기",
          manager: ["홍길동", "이현우", "박지현"][i % 3],
          detail: {
            reply: i === 0 ? "안녕하세요. 상담 테스트 1번의 답변 내용입니다.\n문의주신 결제 오류는 현재 정상 처리되었습니다.\n아래 결제오류 해결하는 방법입니다.\nB2B관리자단 > 수강결제내역 > 이름으로 검색하여 취소" : "",
          },
        })).sort((a, b) => new Date(b.datetime) - new Date(a.datetime));

        const studyData = Array.from({ length: 10 }, (_, i) => ({
          round: `2025${10 + i}`,
          code: `LGC${100 + i}`,
          subject: `	[2025 하반기] 한 번에 합격하는 자소서 작성법 - 대한항공(일반직) ${i + 1}`,
          period: `2025-09-${1 + i} ~ 2025-09-${10 + i}`,
          reviewPeriod: `2025-10-${1 + i} ~ 2025-10-${10 + i}`,
          attend: `${80 + i}%`,
          test: `${70 + i}%`,
          mock: `${75 + i}%`,
          reset: i % 3,
          level: i + 1,
          grade: ["A", "B", "C"][i % 3],
          complete: i % 2 === 0 ? "Y" : "N",
          baseScore: 80,
          provider: "자체강의",
          regDate: `2025-09-${15 + i}`,
        })).sort((a, b) => parseInt(b.round) - parseInt(a.round));

        const newDeliveryData = Array.from({ length: 10 }, (_, i) => ({
          orderDate: `2025-09-${String(10 + i).padStart(2, '0')}`,
          orderNo: `ORD${1000 + i}`,
          book: `산업안전 교재 ${i + 1}`,
          amount: `${12000 + i * 500}원`,
          storeOrder: `BOOK${200 + i}`,
          courier: "CJ대한통운",
          tracking: `12345${i}`,
          status: i % 2 === 0 ? "배송완료" : "배송중",
          payDate: `2025-09-${String(5 + i).padStart(2, '0')}`,
          deliveryMethod: i % 2 === 0 ? "SAP" : "교보문고",
        })).sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));


        // ✅ 모달 제어
        const modalOverlay = document.getElementById("modalOverlay");
        const modalTitle = document.getElementById("modalTitle");
        const modalContent = document.getElementById("modalContent");
        const saveBtn = document.getElementById("saveBtn");
        const closeBtn = document.getElementById("closeBtn");

        function closeModal() {
          // 수정 모드 해제
          document.querySelectorAll(".editable").forEach((td) => {
            td.contentEditable = "false";
            td.classList.remove("bg-yellow-50", "border-2", "border-yellow-400");
          });
          saveBtn.classList.add("hidden");
          modalOverlay.classList.add("hidden");
        }

        closeBtn.addEventListener("click", closeModal);
        
        // 모달 배경 클릭 시 닫기
        modalOverlay.addEventListener("click", (e) => {
          if (e.target === modalOverlay) {
            closeModal();
          }
        });

        function openModal(title, data, editable = false) {
          modalTitle.textContent = title;
          modalContent.innerHTML = `
          <div class='bg-blue-50 rounded-lg p-4 border border-blue-200'>
          <table class='w-full border-collapse text-sm'>
            <tbody>
              ${Object.entries(data)
              .map(([key, val]) => {
                  if (key === 'Password') {
                    return `
                      <tr class='border-b border-blue-100'>
                        <td class='p-3 bg-blue-400 text-white font-semibold w-36 rounded-l'>Password</td>
                        <td class='p-3 bg-white'>
                          <button onclick="resetPassword('${data['아이디']}')" class='text-red-600 font-semibold hover:underline'>비밀번호 초기화</button>
                          <p class='text-xs text-gray-500 mt-1'>※ 초기화시 아이디와 동일하게 적용되며, 분실시에만 사용 해주세요!</p>
                        </td>
                      </tr>
                    `;
                  }
                  return `
                    <tr class='border-b border-blue-100'>
                      <td class='p-3 bg-blue-400 text-white font-semibold w-36 rounded-l'>${key}</td>
                      <td class='p-3 bg-white ${editable ? "editable" : ""}' contenteditable="false">${val}</td>
                    </tr>
                  `;
                }
              )
              .join("")}
            </tbody>
          </table>
          </div>
          ${editable
              ? `<div class='flex justify-end mt-4'>
                  <button id='editBtn' class='bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition'>수정하기</button>
                </div>`
              : ""
            }
        `;
          modalOverlay.classList.remove("hidden");
          if (editable) {
            const editBtn = document.getElementById("editBtn");
            editBtn.addEventListener("click", () => {
              document.querySelectorAll(".editable").forEach((td) => {
                td.contentEditable = "true";
                td.classList.add("bg-yellow-50", "border-2", "border-yellow-400");
              });
              saveBtn.classList.remove("hidden");
              editBtn.classList.add("hidden");
            });
          }
        }

        function resetPassword(userId) {
          if (confirm('비밀번호를 초기화 하시겠습니까?')) {
            // 실제 로직에서는 여기서 서버에 비밀번호 변경 요청을 보냅니다.
            alert(`비밀번호가 아이디('${userId}')와 동일하게 초기화되었습니다.`);
          }
        }

        document.getElementById("menuUserInfo").addEventListener("click", () => {
          openModal("회원 정보", memberData, true);
        });

        document.getElementById("menuDeliveryInfo").addEventListener("click", () => {
          openModal("배송지 정보", deliveryData, true);
        });

        document.getElementById("menuAdminSite").addEventListener("click", () => {
          alert("관리자 사이트로 이동합니다.");
        });

        document.getElementById("menuUserSite").addEventListener("click", () => {
          alert("학습자 사이트로 이동합니다.");
        });

        saveBtn.onclick = () => {
          alert("✅ 저장되었습니다!");
          closeModal();
        };

        // ✅ 이메일 전송 모달 로직
        const emailModal = document.getElementById("emailModal");
        const menuSendEmail = document.getElementById("menuSendEmail");
        const closeEmailModalBtn = document.getElementById("closeEmailModalBtn");

        function openEmailModal() {
          emailModal.classList.remove("hidden");
        }
        function closeEmailModal() {
          emailModal.classList.add("hidden");
        }

        menuSendEmail.addEventListener("click", openEmailModal);
        closeEmailModalBtn.addEventListener("click", closeEmailModal);
        emailModal.addEventListener("click", (e) => {
          if (e.target === emailModal) closeEmailModal();
        });

        document.getElementById("sendWebmail").addEventListener("click", () => {
          alert("웹메일(Biz)로 이동합니다.");
          closeEmailModal();
        });
        document.getElementById("sendPassmail").addEventListener("click", () => {
          alert("패스메일(fnBiz)로 이동합니다.");
          closeEmailModal();
        });

        // 4️⃣ --- 문자 발송 모달 로직 ---
        const smsModal = document.getElementById("smsModal");
        const menuSendSms = document.getElementById("menuSendSms");
        const closeSmsModalBtn = document.getElementById("closeSmsModalBtn");
        const sendSmsBtn = document.getElementById("sendSmsBtn");
        const smsTemplateBody = document.getElementById("smsTemplateBody");
        const templateSearch = document.getElementById("templateSearch");
        const smsContent = document.getElementById("smsContent");
        const templatePagination = document.getElementById("templatePagination");

        let currentTemplates = [...smsTemplates];
        const templatesPerPage = 10;
        let currentPage = 1;

        // 템플릿 렌더링 및 페이지네이션
        function renderSmsTemplates() {
            smsTemplateBody.innerHTML = "";
            
            const start = (currentPage - 1) * templatesPerPage;
            const end = start + templatesPerPage;
            const paginatedTemplates = currentTemplates.slice(start, end);

            paginatedTemplates.forEach(template => {
                const tr = document.createElement("tr");
                tr.className = "border-t hover:bg-blue-50 cursor-pointer";
                tr.innerHTML = `<td class="p-2 text-center">${template.id}</td><td class="p-2">${template.title}</td>`;
                tr.addEventListener('click', () => {
                    smsContent.value = template.content;
                    // 선택된 행 하이라이트
                    Array.from(smsTemplateBody.querySelectorAll('tr')).forEach(row => row.classList.remove('bg-blue-100', 'font-semibold'));
                    tr.classList.add('bg-blue-100', 'font-semibold');
                });
                smsTemplateBody.appendChild(tr);
            });

            renderPagination();
        }

        // 페이지네이션 버튼 렌더링
        function renderPagination() {
            templatePagination.innerHTML = "";
            const pageCount = Math.ceil(currentTemplates.length / templatesPerPage);

            for (let i = 1; i <= pageCount; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = `px-3 py-1 rounded ${currentPage === i ? 'bg-blue-600 text-white' : 'bg-gray-200 hover:bg-gray-300'}`;
                pageBtn.onclick = () => {
                    currentPage = i;
                    renderSmsTemplates();
                };
                templatePagination.appendChild(pageBtn);
            }
        }

        // 템플릿 검색
        templateSearch.addEventListener('input', () => {
            const searchTerm = templateSearch.value.toLowerCase();
            currentTemplates = smsTemplates.filter(t => t.title.toLowerCase().includes(searchTerm));
            currentPage = 1;
            renderSmsTemplates();
        });

        // 모달 열기
        menuSendSms.addEventListener("click", () => {
            const customerPhone = document.getElementById("customer-phone").textContent;
            document.getElementById("smsReceiver").value = customerPhone;
            
            // 모달 열 때 초기화
            templateSearch.value = "";
            currentTemplates = [...smsTemplates];
            currentPage = 1;
            smsContent.value = "";
            renderSmsTemplates();

            smsModal.classList.remove("hidden");
        });

        // 모달 닫기
        function closeSmsModal() {
            smsModal.classList.add("hidden");
        }
        closeSmsModalBtn.addEventListener("click", closeSmsModal);
        smsModal.addEventListener('click', (e) => {
            if (e.target === smsModal) {
                closeSmsModal();
            }
        });

        // 발송 버튼
        sendSmsBtn.addEventListener("click", () => {
            const receiver = document.getElementById("smsReceiver").value;
            const content = document.getElementById("smsContent").value;
            if (!content) {
                alert("문자 내용을 입력해주세요.");
                return;
            }
            alert(`'${receiver}' 번호로 문자가 발송되었습니다.\n\n내용: ${content}`);
            closeSmsModal();
        });

        // 3️⃣ --- 테이블 렌더링 (상담이력, 학습관리, 배송관리) --- (복구 및 통합)
        const historyBody = document.getElementById("history-body");
        const historyMore = document.getElementById("history-more");
        let shownCount = 5;

        function renderHistory(limit) {
          historyBody.innerHTML = "";
          if (historyData.length === 0) {
            historyBody.innerHTML = `<tr><td colspan="5" class="text-center p-4 text-gray-500">데이터가 없습니다.</td></tr>`;
            return;
          }
          historyData
            .slice(0, limit)
            .forEach((h) => {
              const tr = document.createElement("tr");
              tr.className = "border-b hover:bg-blue-50 cursor-pointer";
              tr.innerHTML = `
                <td class="p-3">${h.datetime}</td>
                <td class="p-3">${h.channel}</td>
                <td class="p-3">${h.title}</td>
                <td class="p-3 font-semibold ${h.status === "처리완료" ? "text-green-600" : "text-red-600"}">${h.status}</td>
                <td class="p-3">${h.manager}</td>`;
              historyBody.appendChild(tr);
            });
        }

        // 초기 렌더링
        renderHistory(shownCount);

        // 더보기 버튼 표시 및 이벤트
        if (historyData.length > 5) {
          historyMore.classList.remove("hidden");
        }
        historyMore.addEventListener("click", () => {
          shownCount += 5;
          renderHistory(shownCount);
          if (shownCount >= historyData.length) {
            historyMore.classList.add("hidden");
          }
        });

        // ✅ 상담 클릭 시 상세 정보 표시 (선택행 하이라이트 포함)
        const historyDetail = document.getElementById("history-detail");

        historyBody.addEventListener("click", (e) => {
          const row = e.target.closest("tr");
          if (!row || row.querySelector('td[colspan="5"]')) return; // 데이터 없는 행 클릭 방지

          Array.from(historyBody.querySelectorAll("tr")).forEach((r) =>
            r.classList.remove("bg-blue-100")
          );
          row.classList.add("bg-blue-100");

          const index = Array.from(historyBody.children).indexOf(row);
          const h = historyData.slice(0, shownCount)[index]; // 현재 보여지는 데이터셋에서 인덱스 찾기
          if (!h) return;

          historyDetail.classList.remove("hidden");
          historyDetail.innerHTML = `
            <h4 class="font-semibold text-blue-700 text-md mb-3">${h.title}</h4>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
              <table class="w-full border-separate border-spacing-y-2 text-sm">
                <tbody>
                  <tr>
                    <td class="p-2 bg-gray-50 w-32 font-semibold rounded-l-lg">상담채널</td>
                    <td class="p-2 rounded-r-lg border border-gray-100">${h.channel}</td>
                  </tr>
                  <tr>
                    <td class="p-2 bg-gray-50 font-semibold rounded-l-lg">대분류</td>
                    <td class="p-2 rounded-r-lg border border-gray-100">${h.categoryMain}</td>
                  </tr>
                  <tr>
                    <td class="p-2 bg-gray-50 font-semibold rounded-l-lg">중분류</td>
                    <td class="p-2 rounded-r-lg border border-gray-100">${h.categorySub}</td>
                  </tr>
                  <tr>
                    <td class="p-2 bg-gray-50 font-semibold rounded-l-lg">상담일시</td>
                    <td class="p-2 rounded-r-lg border border-gray-100">${h.datetime}</td>
                  </tr>
                  <tr>
                    <td class="p-2 bg-gray-50 font-semibold rounded-l-lg">담당자</td>
                    <td class="p-2 rounded-r-lg border border-gray-100">${h.manager}</td>
                  </tr>
                  <tr>
                    <td class="p-2 bg-gray-50 font-semibold rounded-l-lg">진행상태</td>
                    <td class="p-2 rounded-r-lg border border-gray-100">${h.status}</td>
                  </tr>
                  <tr>
                    <td class="p-2 bg-gray-50 font-semibold rounded-l-lg">답변내용</td>
                    <td class="p-2 rounded-r-lg border border-gray-100 whitespace-pre-wrap text-gray-700">${h.detail?.reply || "내용 없음"}</td>
                  </tr>
                </tbody>
              </table>
            </div>`;
        }); 

        // ✅ 학습관리 렌더링
        const studyBody = document.getElementById("study-body");
        const studyMore = document.getElementById("study-more");
        let studyShown = 5;

        function renderStudy(limit) {
          studyBody.innerHTML = "";
          if (studyData.length === 0) {
            document.getElementById("study-empty").classList.remove("hidden");
            return;
          }
          studyData
            .slice(0, limit)
            .forEach((s) => {
              const tr = document.createElement("tr");
              tr.className = "border-b hover:bg-blue-50 cursor-pointer";
              tr.innerHTML = `
                <td class="p-3">${s.round}</td>
                <td class="p-3">${s.code}</td>
                <td class="p-3">${s.subject}</td>
                <td class="p-3">${s.period}</td>
                <td class="p-3">${s.reviewPeriod}</td>
                <td class="p-3">${s.attend}</td>
                <td class="p-3">${s.test}</td>
                <td class="p-3">${s.mock}</td>
                <td class="p-3">${s.reset}</td>
                <td class="p-3">${s.level}</td>
                <td class="p-3">${s.grade}</td>
                <td class="p-3">${s.complete}</td>
                <td class="p-3">${s.baseScore}</td>
                <td class="p-3">${s.provider}</td>
                <td class="p-3">${s.regDate}</td>`;
              studyBody.appendChild(tr);
            });
        }

        renderStudy(studyShown);

        if (studyData.length > 5) {
          studyMore.classList.remove("hidden");
        }
        studyMore.addEventListener("click", () => {
          studyShown += 5;
          renderStudy(studyShown);
          if (studyShown >= studyData.length) {
            studyMore.classList.add("hidden");
          }
        });

        // ✅ 학습관리 행 클릭 시 모달 열기
        const studyActionModal = document.getElementById("studyActionModal");
        const closeStudyModalBtn = document.getElementById("closeStudyModalBtn");

        studyBody.addEventListener("click", (e) => {
          if (e.target.closest("tr")) {
            studyActionModal.classList.remove("hidden");
          }
        });

        function closeStudyModal() {
          studyActionModal.classList.add("hidden");
        }

        closeStudyModalBtn.addEventListener("click", closeStudyModal);
        studyActionModal.addEventListener("click", (e) => { if (e.target === studyActionModal) closeStudyModal(); });

        // ✅ 배송관리 렌더링
        const deliveryBody2 = document.getElementById("delivery-body");
        const deliveryMore = document.getElementById("delivery-more");
        const deliveryEmpty = document.getElementById("delivery-empty");
        let deliveryShown = 5;

        function renderDelivery(limit) {
          deliveryBody2.innerHTML = "";
          newDeliveryData.slice(0, limit).forEach((d) => {
            const tr = document.createElement("tr");
            tr.className = "border-b hover:bg-blue-50";
            tr.innerHTML = `
              <td class="p-3 whitespace-nowrap">${d.orderDate}</td>
              <td class="p-3 whitespace-nowrap">${d.orderNo}</td>
              <td class="p-3 whitespace-nowrap">${d.book}</td>
              <td class="p-3 whitespace-nowrap">${d.amount}</td>
              <td class="p-3 whitespace-nowrap">${d.storeOrder}</td>
              <td class="p-3 whitespace-nowrap">${d.courier}</td>
              <td class="p-3 whitespace-nowrap">${d.tracking}</td>
              <td class="p-3 whitespace-nowrap">${d.status}</td>
              <td class="p-3 whitespace-nowrap">${d.payDate}</td>
              <td class="p-3 whitespace-nowrap">${d.deliveryMethod}</td>`;
            deliveryBody2.appendChild(tr);
          });
        }

        if (newDeliveryData.length === 0) {
          deliveryEmpty.classList.remove("hidden");
        } else {
          renderDelivery(deliveryShown);
          if (newDeliveryData.length > 5) {
            deliveryMore.classList.remove("hidden");
          }
          deliveryMore.addEventListener("click", () => {
            deliveryShown += 5;
            renderDelivery(deliveryShown);
            if (deliveryShown >= newDeliveryData.length) {
              deliveryMore.classList.add("hidden");
            }
          });
        }
      </script>
</body>

</html>