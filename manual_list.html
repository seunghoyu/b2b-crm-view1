<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>B2B CRM 메뉴얼 관리</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
  <style>
    body { font-family: 'Pretendard', sans-serif; }
  </style>
</head>

<body class="bg-gray-50 h-screen flex overflow-hidden"> 
  <!-- ✅ 좌측 사이드 메뉴 (공통) -->
  <aside class="w-[230px] bg-white border-r border-gray-200 text-gray-700 flex-shrink-0">
    <a href="b2b_dashboard_tailwind.html" class="block p-5 text-lg font-bold text-gray-800 border-b border-gray-200 hover:bg-gray-50 transition">
      B2B CRM 메뉴
    </a>

    <nav class="p-3 space-y-2">
      <!-- 관리메뉴 -->
      <div>
        <button id="menuToggle2" class="group w-full flex justify-between items-center px-4 py-2 rounded-lg hover:bg-gray-100 transition">
          <span>관리메뉴</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-500 transition-transform group-open:-rotate-180">
            <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </button>
        <div id="menu2" class="ml-4 mt-2 space-y-1 text-sm">
          <a href="b2b_dashboard_tailwind.html" class="block px-3 py-1 hover:bg-gray-100 rounded">상담 현황</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">기업 목록</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">고객 목록</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">수강시간 조회</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">학습상담·CS 관리</a>
          <a href="manual_list.html" class="block px-3 py-1 bg-gray-100 text-gray-800 rounded font-semibold">메뉴얼 관리</a>
          <a href="customer_search_registration.html" class="block px-3 py-1 hover:bg-gray-100 rounded">고객 검색/등록</a>
        </div>
      </div>
      <!-- 문자관리 -->
      <div>
        <button id="menuToggle1" class="group w-full flex justify-between items-center px-4 py-2 rounded-lg hover:bg-gray-100 transition">
          <span>문자관리</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-500 transition-transform group-open:-rotate-180">
            <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </button>
        <div id="menu1" class="hidden ml-4 mt-2 space-y-1 text-sm">
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">문자발송</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">문자설정</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">발송이력 조회</a>
        </div>
      </div>

      <!-- 이메일 관리 -->
      <div>
        <button id="menuToggleEmail" class="group w-full flex justify-between items-center px-4 py-2 rounded-lg hover:bg-gray-100 transition">
          <span>이메일 관리</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-500 transition-transform group-open:-rotate-180">
            <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </button>
        <div id="menuEmail" class="hidden ml-4 mt-2 space-y-1 text-sm">
          <a href="#" class="block px-3 py-1 hover:bg-gray-100 rounded">웹메일(Biz)</a>
          <a href="#" class="block px-3 py-1 hover:bg-gray-100 rounded">패스메일(fnBiz)</a>
        </div>
      </div>

      <!-- 비즈톡 관리 -->
      <div>
        <button id="menuToggleBiztalk" class="group w-full flex justify-between items-center px-4 py-2 rounded-lg hover:bg-gray-100 transition">
          <span>비즈톡 관리</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-500 transition-transform group-open:-rotate-180">
            <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </button>
        <div id="menuBiztalk" class="hidden ml-4 mt-2 space-y-1 text-sm">
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">비즈톡발송(강의)</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">비즈톡발송(회원)</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">발송이력 조회(강의)</a>
          <a href="#" onclick="alert('챔프B2B운영자(최고운영자)로 이동합니다.')" class="block px-3 py-1 hover:bg-gray-100 rounded">발송이력 조회(회원)</a>
        </div>
      </div>
    </nav>
  </aside>

  <!-- ✅ 메인 영역 -->
  <div class="flex-1 flex flex-col bg-gray-50">
    <!-- 상단 헤더 -->
    <header class="bg-white text-gray-800 py-4 shadow-sm border-b border-gray-200">
      <div class="w-full px-10 flex justify-between items-center">
        <h1 class="text-2xl font-semibold">메뉴얼 관리</h1>
        <span class="text-sm opacity-90">관리자용</span>
      </div>
    </header>

    <main class="flex-1 w-full px-10 py-8 overflow-y-auto">
      <!-- 필터 영역 -->
      <section class="bg-white p-6 rounded-xl shadow mb-8 text-sm">
        <div class="flex items-center space-x-2 mb-5">
          <button id="filter-all" class="filter-btn px-4 py-2 rounded-lg font-semibold transition border bg-gray-800 text-white">전체</button>
          <button id="filter-common" class="filter-btn px-4 py-2 rounded-lg font-semibold transition border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">공통 메뉴얼</button>
          <button id="filter-company" class="filter-btn px-4 py-2 rounded-lg font-semibold transition border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">기업별 메뉴얼</button>
        </div>
        <hr class="mb-6">

        <div class="grid grid-cols-1 md:grid-cols-4 gap-x-6 gap-y-4 items-end">
          <div class="relative">
            <label for="search-company-name" class="font-medium text-gray-700">기업명</label>
            <input type="text" id="search-company-name" placeholder="기업명으로 검색" class="w-full mt-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-gray-500 focus:border-gray-500 focus:outline-none" />
            <div id="company-suggestions" class="hidden absolute z-20 mt-1 w-full bg-white rounded-lg shadow-lg border border-gray-200 max-h-60 overflow-y-auto"></div>
          </div>
          <div>
            <label for="search-company-code" class="font-medium text-gray-700">기업코드</label>
            <input type="text" id="search-company-code" placeholder="기업 선택 시 자동 입력" class="w-full mt-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-gray-500 focus:border-gray-500 focus:outline-none bg-gray-100" readonly />
          </div>
          <div>
            <label for="search-title" class="font-medium text-gray-700">제목</label>
            <input type="text" id="search-title" placeholder="제목으로 검색" class="w-full mt-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-gray-500 focus:border-gray-500 focus:outline-none" />
          </div>
          <div>
            <label for="search-author" class="font-medium text-gray-700">작성자</label>
            <input type="text" id="search-author" placeholder="작성자로 검색" class="w-full mt-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-gray-500 focus:border-gray-500 focus:outline-none" />
          </div>
          <div class="md:col-span-4 flex space-x-2 justify-end">
            <button id="reset-search-btn" class="bg-gray-200 text-gray-800 w-full md:w-auto px-6 h-[42px] rounded-lg hover:bg-gray-300 transition font-semibold">
              초기화
            </button>
            <button id="search-btn" class="bg-gray-800 text-white w-full md:w-auto px-8 h-[42px] rounded-lg hover:bg-gray-700 transition font-semibold shadow-sm">
              검색
            </button>
          </div>
        </div>
      </section>

      <!-- ✅ 메뉴얼 상세 보기 모달 -->
      <div id="manualDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto p-8 relative ">
          <h3 class="text-xl font-bold text-gray-800 mb-6 pb-3 border-b border-gray-200">메뉴얼 상세 보기</h3>
          <div id="manualDetailContentArea" class="text-sm text-gray-700 space-y-4">
            <!-- 상세 내용이 여기에 동적으로 로드됩니다. -->
          </div>
          <div class="flex justify-end mt-8 space-x-3">
            <button id="editManualBtn" class="bg-gray-800 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition font-semibold shadow-sm">
              수정
            </button>
            <button id="saveManualBtn" class="hidden bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition font-semibold shadow-sm">
              저장
            </button>
            <button id="closeManualModalBtn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300 transition font-semibold ">
              닫기
            </button>
          </div>
        </div>
      </div>

      <section class="bg-white p-6 rounded-xl shadow">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold text-gray-800">등록된 메뉴얼 목록</h2>
          <div class="flex items-center space-x-4">
            <button onclick="window.location.href='manual_registration.html'" class="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition text-sm font-semibold shadow-sm">
              메뉴얼 등록
            </button>
            <span id="count" class="text-sm text-gray-500"></span>
          </div>
        </div>

        <!-- 테이블을 감싸는 div에서 overflow-x-auto 제거 -->
        <div>
          <table class="w-full table-auto border-collapse text-sm text-gray-700">
            <thead>
              <tr class="bg-gray-100 border-b text-left text-gray-600">
                <th class="p-4">등록일시</th>
                <th class="p-4">기업코드</th>
                <th class="p-4">기업명</th>
                <th class="p-4">제목</th>
                <th class="p-4">영업담당팀</th>
                <th class="p-4">영업담당자</th>
                <th class="p-4">작성자</th>
              </tr>
            </thead>
            <tbody id="table-body"></tbody>
          </table>
        </div>

        <div class="mt-6 flex justify-center">
            <button id="load-more" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300 transition font-semibold">
                더보기
            </button>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ✅ 사이드메뉴 토글
    const menuToggle1 = document.getElementById("menuToggle1");
    const menuToggle2 = document.getElementById("menuToggle2");
    const menuToggleEmail = document.getElementById("menuToggleEmail");
    const menuToggleBiztalk = document.getElementById("menuToggleBiztalk");
    
    const menu1 = document.getElementById("menu1");
    const menu2 = document.getElementById("menu2");
    const menuEmail = document.getElementById("menuEmail");
    const menuBiztalk = document.getElementById("menuBiztalk");
    
    [menuToggle1, menuToggle2, menuToggleEmail, menuToggleBiztalk].forEach(toggle => {
      toggle.addEventListener("click", () => {
        const menu = toggle.nextElementSibling;
        menu.classList.toggle("hidden");
        toggle.classList.toggle("group-open");
      });
    });

    menu2.classList.remove("hidden"); // 관리메뉴는 기본으로 열어둠
    menuToggle2.classList.add("group-open");

    // ✅ 공통 메뉴얼 FAQ 더미 데이터
    const commonManualFAQs = [
        [
            { order: 1, inquiry: "내일배움카드는 어떻게 신청하나요?", response: "내일배움카드는 고용센터 또는 온라인으로 신청할 수 있습니다. 신청 후 카드 발급까지 약 1-2주 소요됩니다.", note: "신청 방법 안내" },
            { order: 2, inquiry: "환급 과정 수강 후 환급은 언제 받나요?", response: "과정 수료 후 약 1-2개월 내에 환급이 진행됩니다. 정확한 일정은 고용센터로 문의 바랍니다.", note: "환급 일정" },
        ],
        [
            { order: 1, inquiry: "산업안전보건교육은 필수 수강인가요?", response: "네, 근로기준법에 따라 연간 16시간 이상의 산업안전보건교육을 이수해야 합니다.", note: "법정 의무" },
            { order: 2, inquiry: "교육 이수 확인은 어떻게 하나요?", response: "교육 이수 후 시스템에서 자동으로 이수 현황이 기록되며, 고용센터에서도 확인 가능합니다.", note: "이수 확인" },
        ],
        [
            { order: 1, inquiry: "법정의무교육 미이수 시 처벌이 있나요?", response: "법정의무교육 미이수 시 고용노동부로부터 행정 처분을 받을 수 있습니다.", note: "처벌 규정" },
        ],
        [
            { order: 1, inquiry: "환급 과정 신청 기간은 언제인가요?", response: "환급 과정 신청 기간은 매월 1일부터 25일까지입니다.", note: "신청 기간" },
            { order: 2, inquiry: "환급 금액은 얼마인가요?", response: "과정 종류에 따라 다르며, 최대 100만원까지 환급 가능합니다.", note: "환급 금액" },
        ],
    ];
    
    // ✅ 메뉴얼 더미 데이터
    const dummyManuals = Array.from({ length: 20 }, (_, i) => {
        const isCommon = (i + 1) % 5 === 0; // 5번째 데이터마다 공통 메뉴얼로 설정
        const companies = [ { name: "삼성전자", code: "samsung" }, { name: "SK하이닉스", code: "skhynix" }, { name: "LG화학", code: "lgchem" }, { name: "현대자동차", code: "hyundai" }, { name: "카카오", code: "kakao" }, { name: "네이버", code: "naver" }, { name: "CJ푸드빌", code: "cjfood" }, { name: "대한항공", code: "koreanair" }, { name: "다우오피스", code: "daou" }, { name: "포스코", code: "posco" }];
        const company = companies[i % companies.length];
        const authors = ["박지현", "이현우", "김영희", "이하윤"];
        const salesTeams = ["전략사업1팀", "전략사업2팀", "전략사업3팀"];
        const salesManagers = ["박지현", "이현우", "김영희"];
        const opManagers = ["김민준", "이서연", "박도윤"];
        const commonSubjects = ["내일배움카드 메뉴얼", "고용노동부 산업안전보건교육 메뉴얼", "법정의무교육 메뉴얼", "환급 과정 운영 메뉴얼"];
        const subjects = ["산업안전기사", "AFPK", "CFP", "회계사", "컴퓨터활용능력 1급"];
        const periods = ["2025년 상반기", "2025년 하반기", "2024년 11월 교육", "2024년 12월 교육"];
        const subject = subjects[i % subjects.length];
        const period = periods[i % periods.length];
        
        if (isCommon) {
            // 공통 메뉴얼
            const commonIndex = Math.floor((i + 1) / 5) - 1;
            return {
                regDate: `2025-10-${String(20 - i % 20).padStart(2, '0')} ${String(10 + i % 12).padStart(2, '0')}:${String(30 + i % 30).padStart(2, '0')}`,
                companyCode: null,
                companyName: null,
                title: `[공통] ${commonSubjects[commonIndex % commonSubjects.length]}`,
                department: "운영지원팀",
                faqTable: commonManualFAQs[commonIndex % commonManualFAQs.length] || [],
                author: authors[i % authors.length],
            };
        } else {
            // 기업별 메뉴얼
            return {
                regDate: `2025-10-${String(20 - i % 20).padStart(2, '0')} ${String(10 + i % 12).padStart(2, '0')}:${String(30 + i % 30).padStart(2, '0')}`,
                companyCode: company.code,
                companyName: company.name,
                title: `[${company.name}] ${subject} ${period}`,
                siteUrl: `https://${company.code}.hackers.com`,
                contractPeriod: `2025-01-01 ~ 2025-12-31`,
                reviewPeriod: `종료 후 1년`,
                salesTeam: salesTeams[i % salesTeams.length],
                salesManager: salesManagers[i % salesManagers.length],
                opManager: opManagers[i % opManagers.length],
                reportUrl: `http://internal.wiki/doc/${1000+i}`,
                targetAudience: `전직원 대상 (임원 제외)`,
                courses: `1. 비즈니스 영어 회화\n2. 파이썬 데이터 분석`,
                learningMethod: `온라인 동영상 강의 수강 후, 주 1회 퀴즈 응시`,
                completionCondition: `진도율 80% 이상, 시험 60점 이상`,
                encouragement: `월 2회 (첫째, 셋째 주 월요일) 미수강자 대상 독려 메일 발송`,
                settlement: `교육 종료 후 익월 15일 수료 인원 기준 정산`,
                faq: `Q. 모바일에서도 수강 가능한가요?\nA. 네, 모바일 앱을 통해 수강 가능합니다.`,
                author: authors[i % authors.length],
            };
        }
    }).sort((a, b) => new Date(b.regDate) - new Date(a.regDate));

    const tbody = document.getElementById("table-body");
    const loadMoreBtn = document.getElementById("load-more");
    const itemsPerPage = 10;
    let itemsShown = 0;
    let currentFilterType = 'all'; // 'all', 'common', 'company'

    // ✅ 검색 필터 요소
    const searchCompanyName = document.getElementById('search-company-name');
    const searchCompanyCode = document.getElementById('search-company-code');
    const companySuggestions = document.getElementById('company-suggestions');
    const searchTitle = document.getElementById('search-title');
    const searchAuthor = document.getElementById('search-author');
    const searchBtn = document.getElementById('search-btn');
    const resetSearchBtn = document.getElementById('reset-search-btn');
    const filterBtns = document.querySelectorAll('.filter-btn');

    // 필터 버튼 이벤트 리스너
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // 모든 버튼을 기본 스타일(흰색 배경, 검은 글씨)로 초기화
        filterBtns.forEach(b => {
            b.classList.remove('bg-gray-800', 'text-white');
            b.classList.add('bg-white', 'text-gray-700', 'border', 'border-gray-300', 'hover:bg-gray-50');
        });
        // 클릭된 버튼만 활성 스타일(옅은 회색 배경, 파란 글씨)로 변경
        btn.classList.add('bg-gray-800', 'text-white');
        btn.classList.remove('bg-white', 'text-gray-700', 'border', 'border-gray-300', 'hover:bg-gray-50');

        currentFilterType = btn.id.split('-')[1]; // 'all', 'common', 'company'
        
        // 기업명/기업코드 필드 활성화/비활성화
        searchCompanyName.disabled = currentFilterType === 'common';
        handleSearch();
      });
    });

    function renderTable() {
        tbody.innerHTML = ''; // 테이블 비우기

        // 검색어 가져오기
        const companyCodeQuery = searchCompanyCode.value.toLowerCase();
        const companyNameQuery = searchCompanyName.value.toLowerCase();
        const titleQuery = searchTitle.value.toLowerCase();
        const authorQuery = searchAuthor.value.toLowerCase();

        let filteredManuals = dummyManuals;

        // 1. 타입 필터 (공통/기업별)
        if (currentFilterType === 'common') {
          filteredManuals = dummyManuals.filter(m => !m.companyCode);
        } else if (currentFilterType === 'company') {
          filteredManuals = filteredManuals.filter(m => m.companyCode);
        }

        // 2. 검색어 필터
        filteredManuals = filteredManuals.filter(m => 
            (m.companyCode || '').toLowerCase().includes(companyCodeQuery) &&
            (m.companyName || '').toLowerCase().includes(companyNameQuery) &&
            m.title.toLowerCase().includes(titleQuery) &&
            m.author.toLowerCase().includes(authorQuery)
        );

        const toShow = filteredManuals.slice(0, itemsShown + itemsPerPage);
        toShow.forEach((d, index) => {
            const row = document.createElement("tr");
            row.className = "border-b hover:bg-gray-50 transition cursor-pointer";
            row.innerHTML = `
                <!-- 각 td에 데이터 바인딩 -->
                <td class="p-4">${d.regDate}</td>
                <td class="p-4">${d.companyCode || '-'}</td>
                <td class="p-4 font-medium">${d.companyName || '공통'}</td>
                <td class="p-4">${d.title}</td>
                <td class="p-4">${d.salesTeam}</td>
                <td class="p-4">${d.salesManager}</td>
                <td class="p-4">${d.author}</td>
                `;
            // 각 행에 클릭 이벤트 추가하여 필터링된 목록의 데이터 사용
            row.addEventListener('click', (e) => {
                if (!e.target.closest('a')) { // 링크 클릭 시 모달 열림 방지
                    openManualDetail(d);
                }
            });
            tbody.appendChild(row);
        });

        itemsShown = toShow.length;

        if (itemsShown >= filteredManuals.length) {
            loadMoreBtn.style.display = 'none';
        }
        // '더보기' 버튼을 다시 활성화해야 할 경우를 대비
        else {
            loadMoreBtn.style.display = 'block';
        }
        document.getElementById("count").innerText = `총 ${filteredManuals.length}건`;
    }

    function handleSearch() {
        itemsShown = 0; // 검색 시 페이지네이션 초기화
        renderTable();
    }

    loadMoreBtn.addEventListener('click', () => {
        itemsShown += itemsPerPage;
        renderTable();
    });
    searchBtn.addEventListener('click', handleSearch);
    resetSearchBtn.addEventListener('click', () => {
        searchCompanyName.value = '';
        searchCompanyCode.value = '';
        searchTitle.value = '';
        searchAuthor.value = '';
        handleSearch();
    });

    // ✅ 기업명 검색 기능 (b2b_dashboard_tailwind.html 에서 가져옴)
    const companyDB = [
        { name: "삼성전자", code: "samsung" }, { name: "SK하이닉스", code: "skhynix" },
        { name: "LG화학", code: "lgchem" }, { name: "현대자동차", code: "hyundai" },
        { name: "카카오", code: "kakao" }, { name: "네이버", code: "naver" },
        { name: "CJ푸드빌", code: "cjfood" }, { name: "대한항공", code: "koreanair" },
        { name: "다우오피스", code: "daou" }, { name: "포스코", code: "posco" }
    ];

    let highlightedIndex = -1;
    searchCompanyName.addEventListener("input", () => {
        const query = searchCompanyName.value.trim();
        if (query.length === 0) {
            companySuggestions.classList.add("hidden");
            searchCompanyCode.value = ""; // 기업명 비우면 기업코드도 비움
            return;
        }

        const filteredCompanies = companyDB.filter(c => c.name.toLowerCase().includes(query.toLowerCase()));
        
        companySuggestions.innerHTML = "";
        filteredCompanies.forEach(company => {
            const item = document.createElement("div");
            item.className = "px-4 py-2 hover:bg-gray-50 cursor-pointer";
            item.textContent = company.name;
            item.addEventListener("click", () => {
                searchCompanyName.value = company.name;
                companySuggestions.classList.add("hidden");
            });
            companySuggestions.appendChild(item);
        });

        if (filteredCompanies.length > 0) {
            companySuggestions.classList.remove("hidden");
        } else {
            companySuggestions.classList.add("hidden");
        }
        highlightedIndex = -1; // 검색어 변경 시 하이라이트 초기화
    });

    // 다른 곳 클릭 시 제안 창 닫기
    document.addEventListener("click", (e) => {
      if (!searchCompanyName.contains(e.target) && !companySuggestions.contains(e.target)) {
        companySuggestions.classList.add("hidden");
      }
    });

    function highlightItem(index) {
        const items = companySuggestions.querySelectorAll("div");
        items.forEach((item, i) => {
            if (i === index) {
                item.classList.add("bg-gray-100");
                item.scrollIntoView({ block: 'nearest' });
            } else {
                item.classList.remove("bg-gray-100");
            }
        });
    }

    // 엔터 키로 검색 실행
    [searchCompanyName, searchTitle, searchAuthor].forEach(input => {
        input.addEventListener('keydown', e => {
            const items = companySuggestions.querySelectorAll("div");
            if (input === searchCompanyName && !companySuggestions.classList.contains("hidden") && items.length > 0) {
                if (e.key === "ArrowDown") {
                    e.preventDefault();
                    highlightedIndex = (highlightedIndex + 1) % items.length;
                    highlightItem(highlightedIndex);
                    return; // handleSearch()가 실행되지 않도록 함
                } else if (e.key === "ArrowUp") {
                    e.preventDefault();
                    highlightedIndex = (highlightedIndex - 1 + items.length) % items.length;
                    highlightItem(highlightedIndex);
                    return; // handleSearch()가 실행되지 않도록 함
                } else if (e.key === "Enter" && highlightedIndex > -1) {
                    e.preventDefault();
                    items[highlightedIndex].click();
                    companySuggestions.classList.add("hidden");
                    handleSearch(); // 선택 후 검색 실행
                    return;
                }
            }

            if (e.key === 'Enter') {
                handleSearch();
            }
        });
    });

    // 초기 데이터 로드
    renderTable();

    // ✅ 메뉴얼 상세 보기 모달 관련 스크립트
    const manualDetailModal = document.getElementById("manualDetailModal");
    const modalContentArea = document.getElementById("manualDetailContentArea");
    const closeManualModalBtn = document.getElementById("closeManualModalBtn");
    const editManualBtn = document.getElementById("editManualBtn");
    const saveManualBtn = document.getElementById("saveManualBtn");
    let currentManualIndex = -1;

    function openManualDetail(manual) {
        currentManualIndex = dummyManuals.findIndex(m => m.regDate === manual.regDate && m.companyCode === manual.companyCode);
        
        // 공통 메뉴얼인지 확인 (companyCode가 null인 경우)
        const isCommonManual = !manual.companyCode;
        
        let contentHTML = '';
        
        if (isCommonManual) {
            // 공통 메뉴얼 형식 (customer_view.html과 동일)
            const faqRows = (manual.faqTable || []).map(faq => `
              <div class="grid grid-cols-[80px_1fr_1fr_1fr_60px] border-t border-gray-200 items-start">
                <div class="p-2 border-r h-full flex items-center justify-center">
                  <span class="text-sm">${faq.order || ''}</span>
                </div>
                <div class="p-2 border-r h-full">
                  <div class="text-sm whitespace-pre-wrap">${faq.inquiry || ''}</div>
                </div>
                <div class="p-2 border-r h-full">
                  <div class="text-sm whitespace-pre-wrap">${faq.response || ''}</div>
                </div>
                <div class="p-2 h-full">
                  <div class="text-sm whitespace-pre-wrap">${faq.note || ''}</div>
                </div>
                <div class="p-2 flex items-center justify-center h-full"></div>
              </div>
            `).join('');
            
            contentHTML = `<div class="border border-gray-200 rounded-lg overflow-hidden mb-6">
              <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center">
                <div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">제목</div>
                <div class="p-2"><div class="text-sm">${manual.title || ''}</div></div>
              </div>
              <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center">
                <div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">담당부서</div>
                <div class="p-2"><div class="text-sm">${manual.department || ''}</div></div>
              </div>
              <div class="grid grid-cols-[140px_1fr] items-center">
                <div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">작성자</div>
                <div class="p-2"><div class="text-sm">${manual.author || ''}</div></div>
              </div>
            </div>

            <div class="flex justify-between items-center mb-3">
              <h3 class="text-base font-semibold text-gray-800">문의/응대 내용</h3>
            </div>

            <div class="border border-gray-200 rounded-lg overflow-hidden">
              <!-- Table Header -->
              <div class="grid grid-cols-[80px_1fr_1fr_1fr_60px] bg-gray-50 font-semibold text-gray-600 text-center">
                <div class="p-3 border-r">순번</div>
                <div class="p-3 border-r">문의내용</div>
                <div class="p-3 border-r">응대내용</div>
                <div class="p-3">비고</div>
                <div class="p-3 bg-white"></div>
              </div>
              <!-- Table Body -->
              <div id="faq-table-body-view">
                ${faqRows || '<div class="p-4 text-center text-gray-500">문의/응대 내용이 없습니다.</div>'}
              </div>
            </div>`;
        } else {
            // 기업별 메뉴얼 형식 (기존 형식)
            contentHTML = `<div class="border border-gray-200 rounded-lg overflow-hidden text-sm">
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">기업명</div><div class="px-4 py-2 editable-field" data-key="companyName">${manual.companyName || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">기업코드</div><div class="px-4 py-2 editable-field" data-key="companyCode">${manual.companyCode || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">제목</div><div class="px-4 py-2 editable-field" data-key="title">${manual.title || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">교육 사이트 주소</div><div class="px-4 py-2 editable-field" data-key="siteUrl">${manual.siteUrl || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">계약 기간</div><div class="px-4 py-2 space-y-2"><div class="editable-field" data-key="contractPeriod" data-placeholder="정규 교육 기간">${manual.contractPeriod || ''}</div><div class="editable-field" data-key="reviewPeriod" data-placeholder="복습 기간">${manual.reviewPeriod || ''}</div></div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">담당 정보</div><div class="px-4 py-2 grid grid-cols-3 gap-2"><div class="editable-field" data-key="salesTeam" data-placeholder="영업 담당팀">${manual.salesTeam || ''}</div><div class="editable-field" data-key="salesManager" data-placeholder="영업 담당자">${manual.salesManager || ''}</div><div class="editable-field" data-key="opManager" data-placeholder="운영자">${manual.opManager || ''}</div></div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">보고글 히스토리</div><div class="px-4 py-2 editable-field" data-key="reportUrl">${manual.reportUrl || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">교육대상</div><div class="px-4 py-2 editable-field whitespace-pre-wrap" data-key="targetAudience">${manual.targetAudience || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">제공강의</div><div class="px-4 py-2"><div class="editable-field whitespace-pre-wrap" data-key="courses">${manual.courses || ''}</div></div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">학습방법</div><div class="px-4 py-2 editable-field whitespace-pre-wrap" data-key="learningMethod">${manual.learningMethod || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">수료 조건</div><div class="px-4 py-2 editable-field whitespace-pre-wrap" data-key="completionCondition">${manual.completionCondition || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">독려 여부</div><div class="px-4 py-2 editable-field" data-key="encouragement">${manual.encouragement || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">정산 방식</div><div class="px-4 py-2 editable-field whitespace-pre-wrap" data-key="settlement">${manual.settlement || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-start"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">교육 FAQ</div><div class="px-4 py-2 editable-field whitespace-pre-wrap" data-key="faq">${manual.faq || ''}</div></div>
            <div class="grid grid-cols-[140px_1fr] border-b border-gray-200 items-center"><div class="font-semibold text-gray-600 bg-gray-50 p-4 h-full">작성자</div><div class="px-4 py-2 editable-field" data-key="author">${manual.author || ''}</div></div>
        </div>`;
        }
        
        modalContentArea.innerHTML = contentHTML;
        
        // 공통 메뉴얼일 때 모달 크기 조정
        const modalContainer = manualDetailModal.querySelector('.bg-white');
        if (isCommonManual) {
            modalContainer.classList.remove('max-w-3xl');
            modalContainer.classList.add('max-w-5xl', 'w-full');
        } else {
            modalContainer.classList.remove('max-w-5xl');
            modalContainer.classList.add('max-w-3xl');
        }
        
        manualDetailModal.classList.remove("hidden");
        exitEditMode(); // 항상 보기 모드로 시작
    }

    function closeManualDetailModal() {
        manualDetailModal.classList.add("hidden");
    }

    function enterEditMode() {
        modalContentArea.querySelectorAll('.editable-field').forEach(field => {
            const isTextarea = field.classList.contains('whitespace-pre-wrap');
            if (isTextarea) {
                const content = field.innerHTML;
                const key = field.dataset.key;
                field.outerHTML = `<textarea data-key="${key}" class="editable-field w-full border border-yellow-400 rounded-lg p-2 bg-yellow-50 focus:outline-none focus:ring-2 focus:ring-yellow-500" rows="3">${content}</textarea>`;
            } else {
                const placeholder = field.dataset.placeholder || '';
                const label = placeholder ? `<label class="text-xs text-gray-500">${placeholder}</label>` : '';
                const content = field.innerHTML;
                const key = field.dataset.key;
                field.outerHTML = `
                    <div class="border border-yellow-400 rounded-lg bg-yellow-50">
                        ${label}
                        <div data-key="${key}" data-placeholder="${placeholder}" class="editable-field p-2 focus:outline-none" contenteditable="true">${content}</div>
                    </div>
                `;
            }
        });
        editManualBtn.classList.add('hidden');
        saveManualBtn.classList.remove('hidden');
    }

    function exitEditMode() {
        modalContentArea.querySelectorAll('.editable-field').forEach(field => {
            if (field.tagName === 'TEXTAREA') {
                const key = field.dataset.key;
                const content = field.value;
                field.outerHTML = `<div data-key="${key}" class="editable-field whitespace-pre-wrap">${content}</div>`;
            } else if (field.parentElement.classList.contains('border-yellow-400')) {
                const wrapper = field.parentElement;
                const key = field.dataset.key;
                const placeholder = field.dataset.placeholder;
                const content = field.innerHTML;
                wrapper.outerHTML = `<div data-key="${key}" data-placeholder="${placeholder}" class="editable-field">${content}</div>`;
            } else {
                field.contentEditable = "false";
                // This case might not be needed anymore
            }
        });
        editManualBtn.classList.remove('hidden');
        saveManualBtn.classList.add('hidden');
    }

    editManualBtn.addEventListener("click", enterEditMode);

    saveManualBtn.addEventListener("click", () => {
        // 실제 저장 로직은 여기에 구현합니다.
        // 지금은 더미 데이터를 업데이트하고 모달을 닫습니다.
        alert("저장되었습니다.");
        // 여기서 dummyManuals[currentManualIndex] 데이터를 업데이트 할 수 있습니다.
        exitEditMode();
        // 필요 시 테이블을 다시 렌더링 할 수 있습니다.
        // renderTable(); 
    });

    closeManualModalBtn.addEventListener("click", closeManualDetailModal);
    manualDetailModal.addEventListener("click", (e) => {
        if (e.target === manualDetailModal) {
            closeManualDetailModal();
        }
    });

    // 테이블 행 클릭 이벤트는 renderTable 함수 내에서 각 행에 직접 추가됨

  </script>
</body>

</html>
